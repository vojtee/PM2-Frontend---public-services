(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{5557:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return s(5707)}])},7309:function(e,t,s){"use strict";s.d(t,{k:function(){return c}});var a=s(7297),n=s(5152),r=s.n(n),i=s(948);function o(){let e=(0,a.Z)([""]);return o=function(){return e},e}let l=r()(()=>Promise.all([s.e(279),s.e(229)]).then(s.bind(s,7229)),{loadableGenerated:{webpack:()=>[7229]},ssr:!1,loading:()=>null}),c=(0,i.ZP)(l)(o())},5707:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return z}});var a=s(5893),n=s(9008),r=s.n(n),i=s(7357),o=s(1426),l=s(6242),c=s(4267),d=s(5861),h=s(5582),u=s(8334),x=s(7294),p=s(5697),m=s.n(p),g=s(1590),j=s(8445),y=s(9661),Z=s(3219),v=s(7906),f=s(3184),w=s(3816),b=s(8102),k=s(295),S=s(9305),D=s(7720),N=s(2023),C=s(2377);let P=e=>{let{departments:t={departments:t},sx:s}=e,n=t.slice().sort((e,t)=>e.Name&&t.Name?e.Name.localeCompare(t.Name):0),[r,o]=x.useState(0),[d]=x.useState(5),[h,u]=(0,x.useState)(null),p=(e,t)=>{o(t)},m=e=>{u(e===h?null:e)};return(0,a.jsxs)(i.Z,{sx:{display:"flex"},children:[(0,a.jsxs)(l.Z,{sx:{...s,flex:1},children:[(0,a.jsx)(j.Z,{avatar:(0,a.jsx)(y.Z,{sx:{backgroundColor:"warning.main",height:56,width:56,paddingBottom:0},children:(0,a.jsx)(Z.Z,{children:(0,a.jsx)(g.Z,{})})}),title:"Departments:"}),(0,a.jsx)(C.L,{sx:{flexGrow:1},children:(0,a.jsx)(i.Z,{sx:{minWidth:800,paddingTop:0},children:(0,a.jsxs)(v.Z,{children:[(0,a.jsx)(f.Z,{children:(0,a.jsx)(w.Z,{children:(0,a.jsx)(b.Z,{children:"Department name"})})}),(0,a.jsx)(k.Z,{children:n.slice(r*d,r*d+d).map(e=>(0,a.jsx)(w.Z,{hover:!0,onClick:()=>m(e),selected:e===h,children:(0,a.jsx)(b.Z,{children:e.Name})},e.name))})]})})}),(0,a.jsx)(S.Z,{component:"div",count:t.length,rowsPerPage:d,page:r,onPageChange:p,rowsPerPageOptions:[]}),(0,a.jsx)(D.Z,{}),(0,a.jsx)(N.Z,{sx:{justifyContent:"flex-end"}})]}),h&&(0,a.jsx)(l.Z,{sx:{flex:1,marginLeft:2},children:(0,a.jsx)(c.Z,{children:(0,a.jsxs)("div",{children:[(0,a.jsxs)("h3",{children:[h.name," details"]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"Department name:"})," ",h.Name]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"Description:"})," ",h.description]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"Phone Number:"})," ",h.phoneNumber]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"Address:"})," ",h.address]})]})})})]})};P.propTypes={departments:m().array,sx:m().object};var E=s(1929),M=s(7309),_=s(4855);let L=()=>{let e=(0,E.Z)();return{chart:{background:"transparent",stacked:!1,toolbar:{show:!1}},colors:[e.palette.primary.main,e.palette.secondary.main],dataLabels:{enabled:!1},fill:{opacity:1,type:"solid"},grid:{borderColor:e.palette.divider,strokeDashArray:2,xaxis:{lines:{show:!1}},yaxis:{lines:{show:!0}}},legend:{show:!1},plotOptions:{bar:{columnWidth:"40px"}},stroke:{colors:["transparent"],show:!0,width:2},theme:{mode:e.palette.mode},xaxis:{axisBorder:{color:e.palette.divider,show:!0},axisTicks:{color:e.palette.divider,show:!0},categories:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],labels:{offsetY:5,style:{colors:e.palette.text.secondary}}},yaxis:{labels:{formatter:e=>"".concat(e),offsetX:-10,style:{colors:e.palette.text.secondary}}}}},T=e=>{let{chartSeries:t,sx:s}=e,n=L();return(0,a.jsxs)(l.Z,{sx:s,children:[(0,a.jsx)(j.Z,{avatar:(0,a.jsx)(y.Z,{sx:{backgroundColor:"info.main",height:56,width:56,paddingBottom:0},children:(0,a.jsx)(Z.Z,{children:(0,a.jsx)(_.Z,{})})}),title:"Issues per month"}),(0,a.jsx)(c.Z,{children:(0,a.jsx)(M.k,{height:350,options:n,series:t,type:"bar",width:"100%"})})]})};T.protoTypes={chartSeries:m().array.isRequired,sx:m().object};var O=s(55),B=s(940),Y=s(6447),A=s(1088);let I=e=>{let t=(0,E.Z)();return{chart:{background:"transparent"},colors:[t.palette.warning.main,t.palette.success.main],dataLabels:{enabled:!1},labels:e,legend:{show:!1},plotOptions:{pie:{expandOnClick:!1}},states:{active:{filter:{type:"none"}},hover:{filter:{type:"none"}}},stroke:{width:0},theme:{mode:t.palette.mode},tooltip:{fillSeriesColor:!1}}},F={Solving:(0,a.jsx)(Z.Z,{style:{color:"F79009"},children:(0,a.jsx)(B.Z,{})}),Solved:(0,a.jsx)(Z.Z,{style:{color:"#10B981"},children:(0,a.jsx)(O.Z,{})})},G=e=>{let{chartSeries:t,labels:s,sx:n}=e,r=I(s);return(0,a.jsxs)(l.Z,{sx:n,children:[(0,a.jsx)(j.Z,{avatar:(0,a.jsx)(y.Z,{sx:{backgroundColor:"success.main",height:56,width:56,paddingBottom:0},children:(0,a.jsx)(Z.Z,{children:(0,a.jsx)(A.Z,{})})}),title:"This month's issues & their statuses"}),(0,a.jsxs)(c.Z,{children:[(0,a.jsx)(M.k,{height:300,options:r,series:t,type:"donut",width:"100%"}),(0,a.jsx)(Y.Z,{alignItems:"center",direction:"row",justifyContent:"center",spacing:2,sx:{mt:2},children:t.map((e,t)=>{let n=s[t];return(0,a.jsxs)(i.Z,{sx:{display:"flex",flexDirection:"column",alignItems:"center"},children:[F[n],(0,a.jsx)(d.Z,{sx:{my:1},variant:"h6",children:n}),(0,a.jsx)(d.Z,{color:"text.secondary",variant:"subtitle2",children:e})]},n)})})]})]})};G.propTypes={chartSeries:m().array.isRequired,labels:m().array.isRequired,sx:m().object};var R=s(2912),q=s(3703),J=s(7844);s(2662);var W=s(6822);let X=()=>{let e=(0,W.Z)(),[t,s]=(0,x.useState)(null),[n,u]=(0,x.useState)([]),[p,m]=(0,x.useState)([]),[g,j]=(0,x.useState)({thisYear:[],lastYear:[]}),[y,Z]=(0,x.useState)({solving:0,solved:0,published:0,deleted:0}),v=async()=>{try{let t=await e.get("/api/v1/services/me");s(t.data),console.log(t.data)}catch(e){console.log(e)}},f=async()=>{try{let t=await e.get("/api/v1/services/me/departments"),s=t.data.departments.map(e=>({uid:e.uid,Name:e.name,description:e.description,phoneNumber:e.phoneNumber,address:e.address}));u(s)}catch(e){console.log(e)}},w=async()=>{try{let t=[];for(let s=0;s<n.length;s++){let a=await e.get("/api/v1/issues/department/".concat(n[s].uid));a.data.issues.length>0&&t.push(...a.data.issues)}let s=t.map(e=>({id:e.id,name:e.title,description:e.description,longitude:e.coordinates?e.coordinates.longitude:null,latitude:e.coordinates?e.coordinates.latitude:null,dateOfCreation:e.creationDate,status:e.status}));m(s),b(s)}catch(e){console.log(e)}},b=async s=>{try{if(t){let s=(0,R.Z)((0,q.Z)(new Date),"yyyy-MM-dd");console.log(s);let a=await e.get("api/v1/issues/service/".concat(t.uid,"/count?from=").concat(s,"&statuses=SOLVED")),n=await e.get("api/v1/issues/service/".concat(t.uid,"/count?from=").concat(s,"&statuses=SOLVING")),r=await e.get("api/v1/issues/service/".concat(t.uid,"/count?from=").concat(s,"&statuses=PUBLISHED")),i=await e.get("api/v1/issues/service/".concat(t.uid,"/count?from=").concat(s,"&statuses=DELETED")),o=a.data.count,l=n.data.count,c=r.data.count,d=i.data.count;Z({solved:o,solving:l,published:c,deleted:d})}}catch(e){console.log(e)}},k=async()=>{try{if(t){console.log("zacatek year dat");let s=new Date().getFullYear(),a=s-1,n=Array.from({length:12},(e,t)=>t),r=n.map(async a=>{let n=(0,R.Z)(new Date(s,a,1),"yyyy-MM-dd"),r=(0,R.Z)((0,J.Z)(new Date(s,a)),"yyyy-MM-dd"),i=await e.get("api/v1/issues/service/".concat(t.uid,"/count?from=").concat(n,"&to=").concat(r));return i.data.count}),i=n.map(async s=>{let n=(0,R.Z)(new Date(a,s,1),"yyyy-MM-dd"),r=(0,R.Z)((0,J.Z)(new Date(a,s)),"yyyy-MM-dd"),i=await e.get("api/v1/issues/service/".concat(t.uid,"/count?from=").concat(n,"&to=").concat(r));return i.data.count}),[o,l]=await Promise.all([Promise.all(r),Promise.all(i)]);j({thisYear:o,lastYear:l}),console.log("yearly graph data"),console.log(g)}}catch(e){console.log(e)}};return(0,x.useEffect)(()=>{let e=async()=>{await v(),console.log("service fetched")};e()},[]),(0,x.useEffect)(()=>{let e=async()=>{t&&(await f(),await w(),await k())};e()},[t]),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(r(),{children:(0,a.jsx)("title",{children:"Better City"})}),(0,a.jsxs)(i.Z,{component:"main",sx:{flexGrow:1,py:8},children:[(0,a.jsx)(o.Z,{container:!0,spacing:3,children:(0,a.jsx)(o.Z,{item:!0,xs:12,sx:{paddingTop:0},children:(0,a.jsx)(l.Z,{children:(0,a.jsx)(c.Z,{children:(0,a.jsx)(d.Z,{variant:"h5",children:t?t.name:null})})})})}),(0,a.jsx)(h.Z,{maxWidth:"xl",children:(0,a.jsxs)(o.Z,{container:!0,spacing:3,children:[(0,a.jsx)(o.Z,{xs:12,md:12,lg:8,children:(0,a.jsx)(P,{departments:n,sx:{height:"100%"}})}),(0,a.jsx)(o.Z,{xs:12,md:6,lg:4,children:(0,a.jsx)(G,{chartSeries:[y.solving,y.solved],labels:["Solving","Solved"],sx:{height:"100%"}})}),(0,a.jsx)(o.Z,{xs:12,lg:8,children:(0,a.jsx)(T,{chartSeries:[{name:"This year",data:g.thisYear},{name:"Last year",data:g.lastYear}],sx:{height:"100%"}})})]})})]})]})};X.getLayout=e=>(0,a.jsx)(u.A,{children:e});var z=X},6822:function(e,t,s){"use strict";var a=s(5121);let n=()=>{let e=a.Z.create({baseURL:"https://bettercity.mikita.dev",timeout:8e3,headers:{Authorization:"Bearer "+window.sessionStorage.getItem("token")}});return e};t.Z=n}},function(e){e.O(0,[60,230,410,703,121,146,434,334,774,888,179],function(){return e(e.s=5557)}),_N_E=e.O()}]);